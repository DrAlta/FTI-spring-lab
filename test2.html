<!DOCTYPE html>
<meta charset="utf-8">
<svg width="400" height="400"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>
//create somewhere to put the force directed graph

var nodes_data =  [
    {"name": "Lillian", "sex": "F", width:100},
    {"name": "Gordon", "sex": "M", width: 100},
    ]

//Sample links data 
//type: A for Ally, E for Enemy
var links_data = [
	{"source": "Lillian", "target": "Gordon", "type":"A" },
    
]


//set up the simulation 
var simulation = d3.forceSimulation()
					//add nodes
					.nodes(nodes_data);
                    
                
             
var link_force =  d3.forceLink(links_data)
                        .id(function(d) { return d.name; });            
            
var charge_force = d3.forceManyBody()
    .strength(-100);
    
var center_force = d3.forceCenter(width / 2, height / 2);  
 
//custom force example 
// bring all male nodes to right side, all female nodes to left side 
function splitting_force() { 
  for (var i = 0, n = nodes_data.length; i < n; ++i) {
    curr_node = nodes_data[i];
    if(curr_node.sex == "M"){
        curr_node.x += 5;
    } else if(curr_node.sex == "F"){
        curr_node.x -= 5;
    }    
  }
}
poslinks=[{source:0, target: 1, x: 100, y: 0}];
  function forceRelPos(alpha) {
    console.log("test");
      for (var i = 0, n = poslinks.length; i < n; ++i) {
          var link = poslinks[i];
          var source=nodes_data[link.source];
          var target=nodes_data[link.target];
          var rx = (source.x +source.vx - target.x - target.vx);
          var ry = (source.y +source.vy - target.y - target.vy);
          target.vx += (rx + link.x) * alpha;
          target.vy += (ry + link.y) ;
          rx = (target.x +target.vx - source.x - source.vx);
          ry = (target.y +target.vy - source.y - source.vy);
          source.vx += (rx - link.x) * alpha;
          source.vy += (ry - link.y) * alpha;
        console.log('rx: ' + rx +'test'+ (link.x));
      };
  };
rellinks=[{source:0, target: 1, relation: "overlap"}];
   function forceRel(alpha) {
        console.log("test");
         for (var i = 0, n = rellinks.length; i < n; ++i) {
            var link = rellinks[i];
            var source=nodes_data[link.source];
            var target=nodes_data[link.target];
		    var st = source.x + source.vx;
		    var tt = target.x + target.vx;
		    var tw = target.width + source.width;
            if ( st < tt-tw){
		        //source before target
				console.log("before");
				if (link.relation != "left") {
				    console.log(tt - st)
	                target.vx -= (tt - st + tw) * alpha;
				};
		    }else if (st > tt+tw) {
		        //source after target  
				console.log("after");
				if (link.relation != "right") {
	                target.vx -= (tt - st - tw) * alpha;
				};
		    } else {
		        //overlaps
				console.log("overlaps");

				if (link.relation == "left") {
				    console.log("OL");
	                target.vx -= (tt - st -tw) * alpha;
				}else if (link.relation == "right") {
				    console.log("OR");
	                target.vx -= (tt - st + tw) * alpha;
				};
		    };
      };
  };
               
                        
simulation
    .force("charge_force", charge_force)
    .force("center_force", center_force)
    .force("links",link_force)
    .force("splitting",forceRel);

//add tick instructions: 
simulation.on("tick", tickActions );


</script>